<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MEMECRAFT AI Gallery â€” browse and manage all your AI-generated memes and posters.">
    <title>MEMECRAFT AI Â· Gallery</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,400;0,14..32,500;1,14..32,400&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">

    <style>
        /* Gallery card */
        .gallery-card {
            transition: all 0.25s cubic-bezier(0.2,0,0,1);
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.75);
            backdrop-filter: blur(10px);
        }
        .gallery-card:hover { transform: scale(1.03) translateY(-5px); box-shadow: 0 20px 40px -10px rgba(0,0,0,0.18); }
        .gallery-card .card-actions { opacity: 0; transition: opacity 0.2s ease; }
        .gallery-card:hover .card-actions { opacity: 1; }

        /* Filter tabs */
        .filter-tab { transition: all 0.2s ease; }
        .filter-tab.active { background: black; color: white; }

        /* Lightbox */
        #lightbox { transition: opacity 0.25s ease; }
        #lightbox.hidden { pointer-events: none; }

        /* Mode badge colours */
        .badge-meme   { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
        .badge-poster { background: #fce7f3; color: #9d174d; border: 1px solid #f9a8d4; }
        .badge-remix  { background: #ede9fe; color: #4c1d95; border: 1px solid #c4b5fd; }

        @keyframes scaleIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .scale-in { animation: scaleIn 0.2s ease forwards; }
    </style>
</head>
<body class="min-h-screen flex flex-col text-gray-800 antialiased overflow-x-hidden">

    <div id="nav-root"></div>

    <main class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex-1">

        <!-- Page header -->
        <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
            <div>
                <h1 class="font-meme text-3xl sm:text-4xl font-bold flex items-center gap-3">
                    <i class="fa-regular fa-images text-amber-500" aria-hidden="true"></i> My Gallery
                </h1>
                <p class="text-sm text-gray-500 mt-1">All your AI-generated creations, stored locally.</p>
            </div>
            <div class="flex gap-2">
                <button id="clear-all-btn" class="px-4 py-2 bg-white/70 border border-red-200 text-red-500 rounded-full text-xs font-medium hover:bg-red-50 hover-lift flex items-center gap-1 transition-all">
                    <i class="fa-regular fa-trash-can" aria-hidden="true"></i> clear all
                </button>
                <a href="studio.html" class="px-4 py-2 bg-black text-white rounded-full text-xs font-medium hover:bg-gray-800 hover-lift flex items-center gap-1 transition-all">
                    <i class="fa-solid fa-plus" aria-hidden="true"></i> create new
                </a>
            </div>
        </div>

        <!-- Filter tabs -->
        <div class="flex gap-2 mb-6 flex-wrap" role="tablist" aria-label="Filter by mode">
            <button class="filter-tab active px-4 py-2 rounded-full text-sm font-meme border border-gray-200 bg-white/60" data-filter="all" role="tab" aria-selected="true">All</button>
            <button class="filter-tab px-4 py-2 rounded-full text-sm font-meme border border-amber-200 bg-white/60" data-filter="meme" role="tab" aria-selected="false">
                <i class="fa-regular fa-face-smile text-amber-500 mr-1" aria-hidden="true"></i>Memes
            </button>
            <button class="filter-tab px-4 py-2 rounded-full text-sm font-meme border border-pink-200 bg-white/60" data-filter="poster" role="tab" aria-selected="false">
                <i class="fa-regular fa-rectangle-ad text-pink-400 mr-1" aria-hidden="true"></i>Posters
            </button>
            <button class="filter-tab px-4 py-2 rounded-full text-sm font-meme border border-indigo-200 bg-white/60" data-filter="remix" role="tab" aria-selected="false">
                <i class="fa-solid fa-wand-sparkles text-indigo-400 mr-1" aria-hidden="true"></i>Remixes
            </button>
        </div>

        <!-- Stats strip -->
        <div class="flex gap-4 mb-6" id="stats-strip" aria-live="polite"></div>

        <!-- Gallery grid -->
        <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4" aria-label="Generated images gallery"></div>

        <!-- Empty state -->
        <div id="empty-state" class="hidden flex-col items-center justify-center py-24 text-center">
            <i class="fa-regular fa-image text-6xl text-amber-300 mb-4" aria-hidden="true"></i>
            <h2 class="font-meme text-xl font-bold text-gray-600 mb-2">No creations yet</h2>
            <p class="text-sm text-gray-400 mb-6">Head to the studio and generate your first meme or poster!</p>
            <a href="studio.html" class="bg-amber-400 hover:bg-amber-500 text-black font-semibold px-6 py-3 rounded-full text-sm shadow-lg hover-lift flex items-center gap-2">
                <i class="fa-solid fa-wand-sparkles" aria-hidden="true"></i> open studio
            </a>
        </div>
    </main>

    <!-- Lightbox -->
    <div id="lightbox" class="fixed inset-0 z-50 hidden opacity-0 flex items-center justify-center p-4" role="dialog" aria-modal="true" aria-label="Image preview">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm" id="lightbox-bg"></div>
        <div class="relative scale-in glass-premium rounded-3xl p-4 sm:p-6 max-w-lg w-full shadow-2xl border border-white/70">
            <button id="lightbox-close" class="absolute top-3 right-3 w-8 h-8 rounded-full bg-white/70 flex items-center justify-center hover:bg-white hover-lift z-10" aria-label="Close preview">
                <i class="fa-solid fa-xmark text-gray-700" aria-hidden="true"></i>
            </button>
            <img id="lightbox-img" src="" alt="Preview" class="w-full rounded-2xl shadow-lg object-contain max-h-[70vh]">
            <div class="mt-3 flex items-center justify-between">
                <div>
                    <p id="lightbox-prompt" class="text-sm font-meme font-semibold text-gray-800 truncate max-w-xs"></p>
                    <span id="lightbox-badge" class="text-xs px-2 py-0.5 rounded-full mt-1 inline-block"></span>
                </div>
                <div class="flex gap-2">
                    <button id="lightbox-download" class="px-4 py-2 bg-black text-white rounded-full text-xs font-medium hover:bg-gray-800 hover-lift flex items-center gap-1" aria-label="Download image">
                        <i class="fa-regular fa-download" aria-hidden="true"></i> download
                    </button>
                    <a id="lightbox-remix" href="studio.html?mode=remix" class="px-4 py-2 bg-amber-100 text-amber-800 border border-amber-300 rounded-full text-xs font-medium hover:bg-amber-200 hover-lift flex items-center gap-1">
                        <i class="fa-solid fa-wand-sparkles" aria-hidden="true"></i> remix
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="mode-toast" role="status" aria-live="polite">
        <i class="fa-regular fa-bell mr-2" aria-hidden="true"></i>
        <span id="toast-message">Done</span>
    </div>

    <!-- Confirm modal -->
    <div id="confirm-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="relative glass-premium rounded-2xl p-6 max-w-sm w-full text-center border border-white/70">
            <i class="fa-solid fa-triangle-exclamation text-3xl text-red-400 mb-3" aria-hidden="true"></i>
            <h3 class="font-meme font-bold text-lg mb-2">Clear all creations?</h3>
            <p class="text-sm text-gray-500 mb-5">This will permanently delete all images from your local gallery.</p>
            <div class="flex gap-3 justify-center">
                <button id="confirm-cancel" class="px-5 py-2 rounded-full border border-gray-200 text-sm hover:bg-gray-50">Cancel</button>
                <button id="confirm-ok" class="px-5 py-2 rounded-full bg-red-500 text-white text-sm hover:bg-red-600">Delete all</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="w-full max-w-7xl mx-auto px-4 py-4 text-xs text-gray-400 flex flex-wrap justify-between items-center gap-2">
        <span>Â© 2025 Â· MEMECRAFT AI gallery</span>
        <span class="flex items-center gap-1"><i class="fa-regular fa-database" aria-hidden="true"></i> stored locally Â· never uploaded</span>
    </footer>

    <script src="api.js"></script>
    <script src="nav.js"></script>
    <script>
    (function () {
        renderNav('gallery');

        let allItems   = [];
        let activeFilter = 'all';
        let lightboxItem = null;

        // ==================== TOAST ====================
        function showToast(msg) {
            const toast = document.getElementById('mode-toast');
            document.getElementById('toast-message').textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2200);
        }

        // ==================== LOAD ====================
        async function loadGallery() {
            allItems = await MemecraftDB.getAll();
            renderStats();
            renderGrid();
        }

        function renderStats() {
            const memes   = allItems.filter(i => i.mode === 'meme').length;
            const posters = allItems.filter(i => i.mode === 'poster').length;
            const remixes = allItems.filter(i => i.mode === 'remix').length;

            document.getElementById('stats-strip').innerHTML = `
                <div class="glass-premium rounded-xl px-4 py-2 text-center border border-white/70 text-xs">
                    <span class="font-meme font-bold text-lg text-amber-600">${allItems.length}</span><br>total
                </div>
                <div class="glass-premium rounded-xl px-4 py-2 text-center border border-white/70 text-xs">
                    <span class="font-meme font-bold text-lg text-amber-500">${memes}</span><br>memes
                </div>
                <div class="glass-premium rounded-xl px-4 py-2 text-center border border-white/70 text-xs">
                    <span class="font-meme font-bold text-lg text-pink-500">${posters}</span><br>posters
                </div>
                <div class="glass-premium rounded-xl px-4 py-2 text-center border border-white/70 text-xs">
                    <span class="font-meme font-bold text-lg text-indigo-500">${remixes}</span><br>remixes
                </div>`;
        }

        function renderGrid() {
            const grid     = document.getElementById('gallery-grid');
            const empty    = document.getElementById('empty-state');
            const filtered = activeFilter === 'all' ? allItems : allItems.filter(i => i.mode === activeFilter);

            grid.innerHTML = '';

            if (filtered.length === 0) {
                empty.classList.remove('hidden');
                empty.classList.add('flex');
                return;
            }

            empty.classList.add('hidden');
            empty.classList.remove('flex');

            filtered.forEach(item => {
                const card = document.createElement('div');
                card.className = 'gallery-card rounded-2xl overflow-hidden cursor-pointer';
                card.setAttribute('role', 'button');
                card.setAttribute('tabindex', '0');
                card.setAttribute('aria-label', `View: ${item.prompt}`);

                const badgeClass = `badge-${item.mode}`;
                const dateStr = new Date(item.timestamp).toLocaleDateString();

                card.innerHTML = `
                    <div class="relative aspect-square bg-amber-50">
                        <img src="data:image/png;base64,${item.imageBase64}" 
                             alt="${item.prompt}" 
                             class="w-full h-full object-cover"
                             loading="lazy">
                        <div class="card-actions absolute inset-0 bg-black/40 flex flex-col items-center justify-center gap-2 p-2">
                            <button class="download-card-btn w-9 h-9 rounded-full bg-white/90 flex items-center justify-center hover:bg-white transition shadow" data-id="${item.id}" aria-label="Download">
                                <i class="fa-regular fa-download text-gray-800 text-sm" aria-hidden="true"></i>
                            </button>
                            <button class="delete-card-btn w-9 h-9 rounded-full bg-red-100/90 flex items-center justify-center hover:bg-red-200 transition shadow" data-id="${item.id}" aria-label="Delete">
                                <i class="fa-regular fa-trash-can text-red-600 text-sm" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-2.5">
                        <p class="text-xs font-meme font-semibold truncate text-gray-800">${item.prompt.slice(0,28)}${item.prompt.length > 28 ? '...' : ''}</p>
                        <div class="flex items-center justify-between mt-1">
                            <span class="text-[10px] px-2 py-0.5 rounded-full font-meme ${badgeClass}">${item.mode}</span>
                            <span class="text-[10px] text-gray-400">${dateStr}</span>
                        </div>
                    </div>`;

                // Open lightbox on card click (not action buttons)
                card.addEventListener('click', (e) => {
                    if (e.target.closest('.download-card-btn') || e.target.closest('.delete-card-btn')) return;
                    openLightbox(item);
                });
                card.addEventListener('keydown', e => { if (e.key === 'Enter') openLightbox(item); });

                // Download
                card.querySelector('.download-card-btn').addEventListener('click', e => {
                    e.stopPropagation();
                    downloadImage(item);
                });

                // Delete
                card.querySelector('.delete-card-btn').addEventListener('click', async e => {
                    e.stopPropagation();
                    await MemecraftDB.remove(item.id);
                    showToast('Deleted âœ“');
                    loadGallery();
                });

                grid.appendChild(card);
            });
        }

        // ==================== LIGHTBOX ====================
        function openLightbox(item) {
            lightboxItem = item;
            const lb = document.getElementById('lightbox');
            document.getElementById('lightbox-img').src = `data:image/png;base64,${item.imageBase64}`;
            document.getElementById('lightbox-prompt').textContent = item.prompt;
            const badge = document.getElementById('lightbox-badge');
            badge.textContent = item.mode;
            badge.className = `text-xs px-2 py-0.5 rounded-full mt-1 inline-block badge-${item.mode}`;
            document.getElementById('lightbox-remix').href = `studio.html?mode=remix&prompt=${encodeURIComponent(item.prompt)}`;
            lb.classList.remove('hidden');
            lb.classList.add('flex');
            requestAnimationFrame(() => lb.classList.remove('opacity-0'));
        }

        function closeLightbox() {
            const lb = document.getElementById('lightbox');
            lb.classList.add('opacity-0');
            setTimeout(() => { lb.classList.add('hidden'); lb.classList.remove('flex'); }, 250);
            lightboxItem = null;
        }

        document.getElementById('lightbox-close').addEventListener('click', closeLightbox);
        document.getElementById('lightbox-bg').addEventListener('click', closeLightbox);
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

        document.getElementById('lightbox-download').addEventListener('click', () => {
            if (lightboxItem) downloadImage(lightboxItem);
        });

        // ==================== DOWNLOAD ====================
        function downloadImage(item) {
            const a = document.createElement('a');
            a.href = `data:image/png;base64,${item.imageBase64}`;
            a.download = `memecraft-${item.mode}-${item.id}.png`;
            a.click();
            showToast('Download started ðŸ“¥');
        }

        // ==================== FILTER TABS ====================
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.filter-tab').forEach(t => {
                    t.classList.remove('active');
                    t.setAttribute('aria-selected', 'false');
                });
                tab.classList.add('active');
                tab.setAttribute('aria-selected', 'true');
                activeFilter = tab.dataset.filter;
                renderGrid();
            });
        });

        // ==================== CLEAR ALL ====================
        document.getElementById('clear-all-btn').addEventListener('click', () => {
            document.getElementById('confirm-modal').classList.remove('hidden');
            document.getElementById('confirm-modal').classList.add('flex');
        });
        document.getElementById('confirm-cancel').addEventListener('click', () => {
            document.getElementById('confirm-modal').classList.add('hidden');
            document.getElementById('confirm-modal').classList.remove('flex');
        });
        document.getElementById('confirm-ok').addEventListener('click', async () => {
            await MemecraftDB.clear();
            document.getElementById('confirm-modal').classList.add('hidden');
            document.getElementById('confirm-modal').classList.remove('flex');
            showToast('All cleared âœ“');
            loadGallery();
        });

        // INIT
        loadGallery();
        console.log('âœ¨ MEMECRAFT AI gallery ready');
    })();
    </script>
</body>
</html>